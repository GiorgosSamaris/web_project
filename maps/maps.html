<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin="anonymous"></script>


    <link type="stylesheet" href="leaflet-search-master\dist\leaflet-search.src.css">
    <script src="https://unpkg.com/leaflet-search@3.0.2/dist/leaflet-search.min.js"></script>
    <script src="leaflet-search-master\dist\leaflet-search.src.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <!-- <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.0/dist/leaflet.css" />
    <link rel="stylesheet" href="../src/leaflet-search.css" />
    <script src="https://unpkg.com/leaflet@1.3.0/dist/leaflet.js"></script>
    <script src="../dist/leaflet-search.src.js"></script> -->
    <link rel="stylesheet" href="maps.css">
    <script src="stores.js"></script>
    <title>Maps</title>
</head>
<body>
    <div id="mapid"></div>
    <script>
        let lat = 38.2462420;
        let lng = 21.7350847;
        let mymap = L.map('mapid');
        let tiles = L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(mymap);

         //#region Functions
        function markerClick(event) {
            this.getPopup()
                .setLatLng(event.latlng)
                .setContent("Συντεταγμένες σημείου: " + event.latlng.toString());
        }

        function popupContent(feature) {
            let popupContent = "";
            
            //show name and if not available then the brand name in english
            if (feature.properties.name) {
                popupContent = feature.properties.name;
            } else if (feature.properties['brand:en']) {
                popupContent = feature.properties['brand:en'];
            }
        
            // Add coordinates 
            popupContent += "<br>Coordinates: " + feature.geometry.coordinates[1] + ", " + feature.geometry.coordinates[0];
        
            //Add opening hours if available
            if (feature.properties.opening_hours) {
                popupContent += "<br>Opening hours: " + feature.properties.opening_hours;
            }
        
            // bold text
            popupContent = "<b>" + popupContent + "</b>";
        
            return popupContent;
        }

        function initializeMap() {
            mymap.setView([lat,lng], 16);
            var markersLayer = new L.LayerGroup();
            mymap.addLayer(markersLayer);

            var controlSearch = new L.Control.Search({
                layer: markersLayer,
                position: "topright",
                initial: false,
                zoom: 12,
                marker: false});

            // let geocode = L.Control.geocode();
            // mymap.addControl(geocode);
    
            L.geoJson(stores_json, {
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(popupContent(feature));
                }
            }).addTo(markersLayer);
            mymap.addControl(controlSearch);
        }
        //#endregion


        if("geolocation" in navigator) {
            //add prompt for user's location
            navigator.geolocation.getCurrentPosition(  //get current position of user
                (position) => {
                    lat = position.coords.latitude;
                    lng = position.coords.longitude;
                    initializeMap();
                },
                (error) => {
                    console.error("Error getting user location: ", error);
                }
            );
        } else {
            console.error("Geolocation is not supported by this browser");
            initializeMap();
        }

        // mymap.setView([38.2462420, 21.7350847], 16);



        
    </script>
</body>
</html>
